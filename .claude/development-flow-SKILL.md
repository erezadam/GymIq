---
name: gymiq-development-flow
description: "Mandatory development workflow for GymIQ. Enforces understanding before coding, impact analysis, and systematic bug prevention. Use BEFORE writing any code - this is the missing link between project-control and qa-testing."
---

# GymIQ Development Flow

**מתי להפעיל:** לפני כל שינוי קוד - זה ה-Skill שמונע תקלות!

## 🚦 תהליך חובה לפני כל שינוי

```
┌─────────────────────────────────────────────────────────────┐
│  משימה → הבנה → תכנון → קוד → בדיקה → commit               │
│           ↑                                                 │
│      אתה כאן                                                │
└─────────────────────────────────────────────────────────────┘
```

---

## שלב 1: הבנת המצב הקיים (חובה!)

### 1.1 מיפוי תלויות
```bash
# מצא מה תלוי בקוד שאתה משנה:
grep -r "FunctionOrComponentName" src/ --include="*.tsx" --include="*.ts"

# דוגמה - אם משנים addExercise:
grep -r "addExercise(" src/ | grep -v "removeExercise"
```

**רשום את התוצאה:**
```
קבצים שמשתמשים בקוד הזה:
1. _______________
2. _______________
3. _______________
```

### 1.2 הבנת הזרימה
```
מאיפה מגיעים לקוד הזה?
User action: _______ → Component: _______ → Function: _______

לאן הנתונים הולכים אחרי?
Function → Store/State: _______ → UI Component: _______
```

### 1.3 בדיקת אזורים רגישים
```bash
# האם אתה נוגע באחד מאלה? (אם כן - זהירות כפולה!)
□ addExercise / removeExercise
□ WorkoutHistory / WorkoutSession
□ calories / estimateCalories
□ workout status (completed/cancelled/in_progress)
□ category / primaryMuscle
```

---

## שלב 2: ניתוח השפעות (Impact Analysis)

### 2.1 מה יכול להישבר?

| אזור | סיכון | בדיקה נדרשת |
|------|-------|-------------|
| זרימת אימון | גבוה | התחל→סיים אימון מלא |
| שמירת נתונים | גבוה | בדוק ב-Firebase שנשמר |
| תצוגת היסטוריה | בינוני | calories, סטים מוצגים נכון |
| UI/RTL | בינוני | בדוק ב-375px |

### 2.2 רשימת בדיקות שאעשה אחרי השינוי
```
□ _________________________________
□ _________________________________
□ _________________________________
```

---

## שלב 3: תכנון השינוי

### 3.1 מה בדיוק אני משנה?
```
קובץ: _______________
פונקציה/רכיב: _______________
שינוי: _______________
```

### 3.2 מה אני לא משנה (גבולות!)
```
❌ לא נוגע ב: _______________
❌ לא מוחק: _______________
❌ לא מוסיף פיצ'רים שלא ביקשו: _______________
```

### 3.3 שינוי מינימלי
> **כלל זהב:** השינוי הקטן ביותר שפותר את הבעיה

---

## שלב 4: קוד + בדיקה מיידית

### 4.1 בזמן הקוד
```
□ שינוי קטן אחד בכל פעם
□ בדיקה מיידית אחרי כל שינוי
□ לא "לנקות" קוד שלא קשור למשימה
```

### 4.2 אחרי כל שינוי
```bash
# בדיקה מהירה:
npm run build 2>&1 | grep -i error
npm run lint 2>&1 | head -20
```

---

## שלב 5: Self-Review לפני Commit

### 5.1 בדיקת רגרסיות קריטיות
```bash
# הרץ תמיד לפני commit:
echo "=== Regression Check ===" && \
grep -r "WorkoutSummaryModal" src/ | wc -l && \
grep -r "handleDeleteWorkout" src/ | wc -l && \
grep -r "workout\.calories" src/ | wc -l && \
grep -r "handleAddSet" src/ | wc -l && \
echo "All counts should be > 0"
```

### 5.2 בדיקת אבטחה
```bash
# ודא שאין מפתחות בקוד:
grep -r "AIza" --include="*.ts" --include="*.tsx" . | grep -v node_modules
# אמור להיות ריק!
```

### 5.3 Checklist סופי
```
□ build עובר בלי שגיאות
□ lint עובר בלי שגיאות
□ בדקתי ב-375px (מובייל)
□ בדקתי זרימה מלאה (לא רק את הפיצ'ר הספציפי)
□ רגרסיות קריטיות קיימות (grep למעלה)
□ אין מפתחות בקוד
```

---

## 🔴 חקירת באגים - תהליך מובנה

### 🚨 כלל ראשון: "נתונים לא נשמרים" = בדוק תצוגה קודם!

> **לקח קריטי (30/01/2026):** משתמש דיווח "אימון לא נשמר". הושקעו 2 סשנים בחקירת מנגנון השמירה (useActiveWorkout, Firebase rules, service worker, toast diagnostics). בסוף - השמירה עבדה מושלם. הבעיה הייתה ב-**תצוגה**: הקומפוננטה WorkoutHistory.tsx סיננה החוצה אימוני AI שהושלמו מכל הסקשנים של הדף.**

**כש-user מדווח "נתונים לא נשמרים" - סדר בדיקה חובה:**

```
1. 🔍 איפה המשתמש בודק? (איזה מסך/דף)
2. 📊 האם הנתונים קיימים ב-Firebase? (בדוק ב-Console/query)
3. 🖥️ האם הקומפוננטה שמציגה את הנתונים מסננת/מחביאה אותם?
4. 🔎 רק אם 2+3 תקינים → חקור את מנגנון השמירה
```

**טעויות נפוצות להימנע מהן:**
- ❌ לא לקפוץ ישר לחקירת מנגנון השמירה
- ❌ לא להוסיף diagnostic toasts לפני שבדקת תצוגה
- ❌ לא להניח שהמשתמש יודע ההבדל בין "לא נשמר" ל-"לא מוצג"
- ✅ תמיד לשאול: "באיזה מסך אתה רואה את הבעיה?"
- ✅ תמיד לבדוק את ה-query/filter שמביא נתונים למסך

**בדיקה מהירה - האם בעיית תצוגה?**
```bash
# מצא את הקומפוננטה שמציגה את הנתונים:
grep -r "שבועיים אחרונים\|getUserWorkoutHistory\|workouts.filter" src/

# בדוק סינון/פילטרים:
grep -r "\.filter(" src/domains/workouts/components/WorkoutHistory.tsx
```

---

### שלב א: הבנת הבעיה
```
מה המשתמש דיווח: _______________
מה היה צריך לקרות: _______________
מה קרה בפועל: _______________
באיזה מסך המשתמש בודק: _______________
```

### שלב ב: בדיקת נתונים (לפני שחזור!)
```
□ האם הנתונים קיימים ב-Firebase/DB?
□ האם ה-query שמביא נתונים למסך מחזיר אותם?
□ האם יש filter/sort שמסתיר את הנתונים?
→ אם הנתונים קיימים אבל לא מוצגים = בעיית תצוגה!
→ אם הנתונים לא קיימים = בעיית שמירה
```

### שלב ג: שחזור
```
Steps to reproduce:
1. _______________
2. _______________
3. _______________
Result: _______________
```

### שלב ד: מיפוי הזרימה הבעייתית
```
שמירה: User action → Function → Firebase → ✅/❌
תצוגה: Firebase → Query → Filter → Component → ✅/❌
                              ↑
                     לרוב הבעיה כאן!
```

### שלב ה: זיהוי נקודת הכשל
```bash
# חפש בקוד:
grep -r "relevantFunction" src/
grep -r "relevantState" src/

# בדוק בקונסול:
# הוסף console.log זמני לזרימה
# עקוב אחרי הנתונים
```

### שלב ו: תיקון ממוקד
```
□ תקן רק את הבעיה - לא "לנקות" סביב
□ בדוק שהתיקון עובד
□ בדוק שלא שברת משהו אחר
□ הסר console.log זמניים
```

### שלב ז: מניעת חזרה
```
□ הוסף בדיקה ל-qa-testing-SKILL.md אם רלוונטי
□ תעד את הבאג ב-CHANGELOG
```

---

## 📋 תבנית דיווח מהיר

```
🎯 משימה: [תיאור קצר]

📖 הבנה:
- קוד רלוונטי: [קבצים]
- תלויות: [מה תלוי בזה]
- אזורים רגישים: [כן/לא - אילו]

📐 תכנון:
- שינוי: [מה בדיוק]
- לא נוגע ב: [גבולות]

✅ בדיקות שבוצעו:
- [ ] build
- [ ] lint
- [ ] 375px
- [ ] זרימה מלאה
- [ ] regression grep

🔐 אבטחה: תקין / נמצאו בעיות
```

---

## 🔗 קישור ל-Skills אחרים

| אחרי שלב | עבור ל-Skill |
|----------|--------------|
| הבנת משימה | project-control-SKILL.md |
| עבודה עם נתונים | firebase-data-SKILL.md |
| שינוי UI | mobile-rtl-SKILL.md |
| סיום ובדיקות | qa-testing-SKILL.md |
| לפני deploy | deployment-SKILL.md |

---

```
══════════════════════════════════════════════════════════════
נוצר: 26/01/2026 | עדכון: 30/01/2026 - הוספת כלל "בדוק תצוגה קודם"
══════════════════════════════════════════════════════════════
```
