# הנחיות לסוכן: מחיקת תוכניות ואימונים (Soft Delete)

קרא את קובץ CLAUDE.md בתיקיית הפרויקט והצהר שקראת אותו לפני שתתחיל לעבוד.

---

## תיאור הפיצ'ר

מתאמן יכול למחוק תוכניות ואימונים - גם כאלה שמאמן בנה או דיווח.
המחיקה היא "רכה" (soft delete) - הנתונים נשארים במערכת אבל מסומנים כמחוקים.

### כללי הפיצ'ר:
- מתאמן מוחק → נעלם ממנו לגמרי (כולל מהיסטוריה)
- מאמן רואה פריטים מחוקים עם סימון ויזואלי + אפשרות "שלח שוב" (לתוכניות בלבד)
- כשמתאמן מוחק אימון שמאמן דיווח (יש reportedBy) → חובה לבחור סיבה
- אין התראות למאמן על מחיקות
- אין שמירת היסטוריית מחיקות

---

## שלב א - חקירה

לפני ביצוע, מצא והצג:

1. היכן מוגדרים הטיפוסים TrainingProgram ו-WorkoutHistoryEntry?
2. היכן המסכים הרלוונטיים בצד מתאמן (תצוגת תוכנית, היסטוריית אימונים)?
3. היכן המסך TraineeDetail בצד מאמן?
4. האם יש פונקציות מחיקה קיימות? מה הן עושות?
5. איך נראה דפוס soft delete קיים במערכת (למשל בקשרי trainer-trainee)?

הצג ממצאים ובקש אישור לפני המשך.

---

## שלב ב - עדכון מודל נתונים

### לטיפוס TrainingProgram הוסף:
```
disconnectedByTrainee?: {
  disconnectedAt: Timestamp
  reason?: string
}
```

### לטיפוס WorkoutHistoryEntry הוסף:
```
deletedByTrainee?: {
  deletedAt: Timestamp
  reason?: string
}
```

---

## שלב ג - שכבת Services

### עבור אימונים (workoutHistory):

1. **צור פונקציית soft delete חדשה**
   - מקבלת: workoutId, reason (אופציונלי)
   - מעדכנת את המסמך עם deletedByTrainee במקום למחוק אותו

2. **עדכן פונקציות שליפה למתאמן**
   - לסנן החוצה אימונים עם deletedByTrainee

3. **צור פונקציית שליפה למאמן**
   - מחזירה את כל האימונים כולל מחוקים

### עבור תוכניות (programService):

1. **צור פונקציית ניתוק (disconnect)**
   - מקבלת: programId, reason (אופציונלי)
   - מעדכנת את המסמך עם disconnectedByTrainee

2. **צור פונקציית חיבור מחדש (reconnect)**
   - מקבלת: programId
   - מסירה את השדה disconnectedByTrainee

3. **עדכן פונקציות שליפה למתאמן**
   - לסנן החוצה תוכניות עם disconnectedByTrainee

4. **צור פונקציית שליפה למאמן**
   - מחזירה את כל התוכניות כולל מנותקות

---

## שלב ד - צד מתאמן: יכולת מחיקה

### מחיקת תוכנית:

**איפה:** במסך תצוגת תוכנית (TraineeProgramView או מקביל)

**התנהגות:**
- הוסף כפתור/אייקון מחיקה
- לחיצה פותחת פופאפ אישור:
  - כותרת: "למחוק את התוכנית?"
  - הצגת שם התוכנית
  - הודעה: "התוכנית תיעלם מהרשימה שלך. היסטוריית האימונים תישמר."
  - כפתורים: ביטול / מחק תוכנית
- אחרי מחיקה: חזרה לדשבורד

### מחיקת אימון:

**איפה:** במסך היסטוריית אימונים (WorkoutHistory)

**שני מצבים:**

**מצב 1 - אימון שמתאמן דיווח בעצמו (אין reportedBy):**
- פופאפ אישור פשוט
- כותרת: "למחוק את האימון?"
- כפתורים: ביטול / מחק אימון

**מצב 2 - אימון שמאמן דיווח (יש reportedBy):**
- פופאפ עם בחירת סיבה (חובה)
- כותרת: "למחוק את האימון?"
- תת-כותרת: "אימון זה דווח על ידי המאמן"
- Dropdown או רשימת בחירה עם סיבות:
  - "האימון לא בוצע בפועל"
  - "דווח בטעות"
  - "נתונים שגויים"
  - "אחר"
- כפתור מחיקה מושבת עד שנבחרה סיבה

---

## שלב ה - צד מאמן: תצוגת פריטים מחוקים

**איפה:** מסך TraineeDetail

### תוכניות מנותקות:

**סדר תצוגה:** תוכניות פעילות קודם, מנותקות בהמשך

**עיצוב תוכנית מנותקת:**
- שקיפות מופחתת (opacity נמוך)
- קו חוצה על שם התוכנית
- תגית "נותק" בצבע אדום/אפור
- שורה נוספת: "נותק ב-[תאריך]"
- אם יש סיבה: "סיבה: [הסיבה]"
- כפתור "שלח שוב"

**כפתור "שלח שוב":**
- לחיצה → פופאפ אישור: "לשלוח את התוכנית שוב? התוכנית תחזור להופיע אצל המתאמן."
- אישור → קריאה לפונקציית reconnect
- התוכנית חוזרת להיות פעילה אצל המתאמן

### אימונים מחוקים:

**סדר תצוגה:** לפי תאריך (מחוקים מעורבבים עם פעילים)

**עיצוב אימון מחוק:**
- שקיפות מופחתת
- קו חוצה על התאריך
- תגית "נמחק" בצבע אדום במקום סטטוס
- שורה נוספת: "נמחק ב-[תאריך] • סיבה: [הסיבה]"
- **אין** כפתור "שלח שוב" לאימונים

---

## שלב ו - עדכון Firestore Rules

וודא שהחוקים מאפשרים:
- מתאמן יכול לעדכן רק את השדה disconnectedByTrainee בתוכניות שלו
- מתאמן יכול לעדכן רק את השדה deletedByTrainee באימונים שלו
- מאמן יכול להסיר את disconnectedByTrainee (לצורך שלח שוב)

---

## בדיקות נדרשות

### צד מתאמן:
1. במסך תוכנית יש אפשרות מחיקה
2. מחיקת תוכנית → פופאפ אישור → תוכנית נעלמת מהרשימה
3. במסך היסטוריה יש אפשרות מחיקת אימון
4. מחיקת אימון עצמאי → פופאפ פשוט → אימון נעלם
5. מחיקת אימון של מאמן → פופאפ עם סיבה חובה → אימון נעלם

### צד מאמן:
6. ב-TraineeDetail: תוכנית מנותקת מוצגת עם סימון ויזואלי וכפתור "שלח שוב"
7. ב-TraineeDetail: אימון מחוק מוצג עם סימון ויזואלי + סיבה
8. לחיצה על "שלח שוב" → פופאפ → תוכנית חוזרת להופיע אצל מתאמן
9. מתאמן רואה שוב את התוכנית ששלחו מחדש

### כללי:
10. npm run build עובר בהצלחה

---

## הערות חשובות

- **אל תמחק נתונים באמת** - רק סמן אותם
- **עקוב אחרי דפוסי עיצוב קיימים** - צבעים מקובץ העיצוב בלבד
- **אל תשנה פונקציות מחיקה קיימות** - צור חדשות לצד
- **שמור על תאימות לאחור** - queries קיימים צריכים להמשיך לעבוד
